<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1'>
    <meta name="format-detection" content="telephone=no"> 
    <link href='/images/favicon.png' rel='shortcut icon' type='image/png'>

    <title>Registering behavior and custom elements - Up.js Guide</title>

    <link href="/stylesheets/application.css" rel="stylesheet" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700|Source+Sans+Pro:300,400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <script src="/javascripts/application.js" type="text/javascript"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-8114576-16', 'auto');
      ga('send', 'pageview');
    </script>

  </head>
  <body>

    <div class="layout">

      <div class="layout__head"></div>

      <div class="layout__body">
        <div class="viewport">
          <div class="layout__side">

            <a href="/" class="logo" up-dash="#content" up-transition="cross-fade">
              <img class="logo__glyph" src="/images/logo.gif" alt="" />
              <span class="logo__name">
                Up.js
              </span>
              <span class="logo__alpha">
                Alpha
              </span>
            </a>

            <div class="menu">
                <a href="/up.link" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Linking to page fragments
                </a>
                <a href="/up.modal" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Modal dialogs
                </a>
                <a href="/up.popup" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Pop-up overlays
                </a>
                <a href="/up.motion" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Animation and transitions
                </a>
                <a href="/up.navigation" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Fast interaction feedback
                </a>
                <a href="/up.magic" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Registering behavior and custom elements
                </a>
                <a href="/up.flow" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Changing page fragments programmatically
                </a>
                <a href="/up.proxy" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Caching and preloading
                </a>
                <a href="/up.form" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Forms and controls
                </a>
                <a href="/up.tooltip" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Tooltips
                </a>
                <a href="/up.history" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Manipulating the browser history
                </a>
                <a href="/up.viewport" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Viewport scrolling
                </a>
                <a href="/up.bus" class="menu__item" up-dash="#content" up-transition="cross-fade">
                  Framework events
                </a>
            </div>

            <div class="layout__fineprint">
              A <a href="http://www.makandra.com/" class="hyperlink is_gray">makandra</a> project
              (<a href="/imprint" class="hyperlink is_gray" up-dash="#content" up-transition="cross-fade">imprint</a>)
            </div>

          </div>

          <div class="layout__content">
            <div id="content">
              

<h1 class="title">
  Registering behavior and custom elements
</h1>

<div class='prose'>
<p>Up.js keeps a persistent Javascript environment during page transitions.
To prevent memory leaks it is important to cleanly set up and tear down
event handlers and custom elements.</p>

<h3 id="incomplete-documentation">Incomplete documentation!</h3>

<p>We need to work on this page:</p>

<ul>
  <li>Better class-level introduction for this module</li>
</ul>

</div>


  <div class="api">

    <div class="api__title">Javascript methods</div>

    <div class="api__explanation">
      Use these methods to programmatically interact
      with Up.js from your own Javascript code.
    </div>

    <div class="api__symbols">

        <div class="symbol is_public" id="up.on">

  <div class="symbol__signature">
    <a href="#up.on">up.on(events, selector, behavior)</a>
  </div>

    <div class="symbol__prose">
      <div class='prose'><p>Binds an event handler to the document, which will be executed whenever the
given event is triggered on the given selector:</p>

<pre><code>up.on('click', '.button', function(event, $element) {
  console.log("Someone clicked the button %o", $element);
});
</code></pre>

<p>This is roughly equivalent to binding a jQuery element to <code>document</code>.</p>

<h4 id="attaching-structured-data">Attaching structured data</h4>

<p>In case you want to attach structured data to the event you're observing,
you can serialize the data to JSON and put it into an <code>[up-data]</code> attribute:</p>

<pre><code>&lt;span class="person" up-data="{ age: 18, name: 'Bob' }"&gt;Bob&lt;/span&gt;
&lt;span class="person" up-data="{ age: 22, name: 'Jim' }"&gt;Jim&lt;/span&gt;
</code></pre>

<p>The JSON will parsed and handed to your event handler as a third argument:</p>

<pre><code>up.on('click', '.person', function(event, $element, data) {
  console.log("This is %o who is %o years old", data.name, data.age);
});
</code></pre>

<h4 id="migrating-jquery-event-handlers-to-upon">Migrating jQuery event handlers to <code>up.on</code></h4>

<p>Within the event handler, Up.js will bind <code>this</code> to the
native DOM element to help you migrate your existing jQuery code to
this new syntax.</p>

<p>So if you had this before:</p>

<pre><code>$(document).on('click', '.button', function() {
  $(this).something();
});
</code></pre>

<p>â€¦ you can simply copy the event handler to <code>up.on</code>:</p>

<pre><code>up.on('click', '.button', function() {
  $(this).something();
});
</code></pre>

</div>
    </div>



    <div class="symbol__subtitle">
      Parameters
    </div>

      <div class="symbol__param">
        <div class="symbol__param_name">
          events          <span class="symbol__type">
            String
          </span>
        </div>
        <div class="symbol__param_prose">
          <div class='prose'><p>A space-separated list of event names to bind.</p>
</div>
        </div>
      </div>
      <div class="symbol__param">
        <div class="symbol__param_name">
          selector          <span class="symbol__type">
            String
          </span>
        </div>
        <div class="symbol__param_prose">
          <div class='prose'><p>The selector an on which the event must be triggered.</p>
</div>
        </div>
      </div>
      <div class="symbol__param">
        <div class="symbol__param_name">
          behavior          <span class="symbol__type">
            Function(event, $element, data)
          </span>
        </div>
        <div class="symbol__param_prose">
          <div class='prose'><p>The handler that should be called.
The function takes the affected element as the first argument (as a jQuery object).
If the element has an <code>up-data</code> attribute, its value is parsed as JSON
and passed as a second argument.</p>
</div>
        </div>
      </div>

  
</div>

        <div class="symbol is_public" id="up.awaken">

  <div class="symbol__signature">
    <a href="#up.awaken">up.awaken(selector, [options], awakener)</a>
  </div>

    <div class="symbol__prose">
      <div class='prose'><p>Registers a function to be called whenever an element with
the given selector is inserted into the DOM through Up.js.</p>

<p>This is a great way to integrate jQuery plugins.
Let's say your Javascript plugin wants you to call <code>lightboxify()</code>
on links that should open a lightbox. You decide to
do this for all links with an <code>[rel=lightbox]</code> attribute:</p>

<pre><code>&lt;a href="river.png" rel="lightbox"&gt;River&lt;/a&gt;
&lt;a href="ocean.png" rel="lightbox"&gt;Ocean&lt;/a&gt;
</code></pre>

<p>This Javascript will do exactly that:</p>

<pre><code>up.awaken('a[rel=lightbox]', function($element) {
  $element.lightboxify();
});
</code></pre>

<p>Note that within the awakener, Up.js will bind <code>this</code> to the
native DOM element to help you migrate your existing jQuery code to
this new syntax.</p>

<h4 id="custom-elements">Custom elements</h4>

<p>You can also use <code>up.awaken</code> to implement custom elements like this:</p>

<pre><code>&lt;current-time&gt;&lt;/current-time&gt;
</code></pre>

<p>Here is the Javascript that inserts the current time into to these elements:</p>

<pre><code>up.awaken('current-time', function($element) {
  var now = new Date();
  $element.text(now.toString()));
});
</code></pre>

<h4 id="cleaning-up-after-yourself">Cleaning up after yourself</h4>

<p>If your awakener returns a function, Up.js will use this as a <em>destructor</em> to
clean up if the element leaves the DOM. Note that in Up.js the same DOM ad Javascript environment
will persist through many page loads, so it's important to not create
<a href="https://makandracards.com/makandra/31325-how-to-create-memory-leaks-in-jquery">memory leaks</a>.</p>

<p>You should clean up after yourself whenever your awakeners have global
side effects, like a <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setInterval"><code>setInterval</code></a>
or event handlers bound to the document root.</p>

<p>Here is a version of <code>&lt;current-time&gt;</code> that updates
the time every second, and cleans up once it's done:</p>

<pre><code>up.awaken('current-time', function($element) {

  function update() {
    var now = new Date();
    $element.text(now.toString()));
  }

  setInterval(update, 1000);

  return function() {
    clearInterval(update);
  };

});
</code></pre>

<p>If we didn't clean up after ourselves, we would have many ticking intervals
operating on detached DOM elements after we have created and removed a couple
of <code>&lt;current-time&gt;</code> elements.</p>

<h4 id="attaching-structured-data">Attaching structured data</h4>

<p>In case you want to attach structured data to the event you're observing,
you can serialize the data to JSON and put it into an <code>[up-data]</code> attribute.
For instance, a container for a <a href="https://developers.google.com/maps/documentation/javascript/tutorial">Google Map</a>
might attach the location and names of its marker pins:</p>

<pre><code>&lt;div class="google-map" up-data="[
  { lat: 48.36, lng: 10.99, title: 'Friedberg' },
  { lat: 48.75, lng: 11.45, title: 'Ingolstadt' }
]"&gt;&lt;/div&gt;
</code></pre>

<p>The JSON will parsed and handed to your event handler as a second argument:</p>

<pre><code>up.awaken('.google-map', function($element, pins) {

  var map = new google.maps.Map($element);

  pins.forEach(function(pin) {
    var position = new google.maps.LatLng(pin.lat, pin.lng);
    new google.maps.Marker({
      position: position,
      map: map,
      title: pin.title
    });
  });

});
</code></pre>

<h4 id="migrating-jquery-event-handlers-to-upon">Migrating jQuery event handlers to <code>up.on</code></h4>

<p>Within the awakener, Up.js will bind <code>this</code> to the
native DOM element to help you migrate your existing jQuery code to
this new syntax.</p>

</div>
    </div>



    <div class="symbol__subtitle">
      Parameters
    </div>

      <div class="symbol__param">
        <div class="symbol__param_name">
          selector          <span class="symbol__type">
            String
          </span>
        </div>
        <div class="symbol__param_prose">
          <div class='prose'><p>The selector to match.</p>
</div>
        </div>
      </div>
      <div class="symbol__param">
        <div class="symbol__param_name">
          [options.batch=false]          <span class="symbol__type">
            Boolean
          </span>
            <span class="symbol__tag is_optional">
              optional
            </span>
        </div>
        <div class="symbol__param_prose">
          <div class='prose'>
<p>If set to <code>true</code> and a fragment insertion contains multiple
elements matching the selector, <code>awakener</code> is only called once
with a jQuery collection containing all matching elements. </p>
</div>
        </div>
      </div>
      <div class="symbol__param">
        <div class="symbol__param_name">
          awakener          <span class="symbol__type">
            Function($element, data)
          </span>
        </div>
        <div class="symbol__param_prose">
          <div class='prose'><p>The function to call when a matching element is inserted.
The function takes the new element as the first argument (as a jQuery object).
If the element has an <code>up-data</code> attribute, its value is parsed as JSON
and passed as a second argument.</p>

<p>The function may return another function that destroys the awakened
object when it is removed from the DOM, by clearing global state such as
time-outs and event handlers bound to the document.</p>
</div>
        </div>
      </div>

  
</div>

        <div class="symbol is_protected" id="up.magic.data">

  <div class="symbol__signature">
    <a href="#up.magic.data">up.magic.data(elementOrSelector)</a>
      <span class="symbol__tag is_visibility">
        protected
      </span>
  </div>

    <div class="symbol__prose">
      <div class='prose'><p>Checks if the given element has an <code>up-data</code> attribute.
If yes, parses the attribute value as JSON and returns the parsed object.</p>

<p>Returns an empty object if the element has no <code>up-data</code> attribute.</p>

<p>The API of this method is likely to change in the future, so
we can support getting or setting individual keys.</p>

</div>
    </div>



    <div class="symbol__subtitle">
      Parameters
    </div>

      <div class="symbol__param">
        <div class="symbol__param_name">
          elementOrSelector          <span class="symbol__type">
            String <span class="symbol__or">or</span> Element <span class="symbol__or">or</span> jQuery
          </span>
        </div>
        <div class="symbol__param_prose">
          <div class='prose'>
</div>
        </div>
      </div>

  
</div>

        <div class="symbol is_public" id="up.ready">

  <div class="symbol__signature">
    <a href="#up.ready">up.ready(selectorOrFragment)</a>
  </div>

    <div class="symbol__prose">
      <div class='prose'><p>Sends a notification that the given element has been inserted
into the DOM. This causes Up.js to compile the fragment (apply
event listeners, etc.).</p>

<p>This method is called automatically if you change elements through
other Up.js methods. You will only need to call this if you
manipulate the DOM without going through Up.js.</p>

</div>
    </div>



    <div class="symbol__subtitle">
      Parameters
    </div>

      <div class="symbol__param">
        <div class="symbol__param_name">
          selectorOrFragment          <span class="symbol__type">
            String <span class="symbol__or">or</span> Element <span class="symbol__or">or</span> jQuery
          </span>
        </div>
        <div class="symbol__param_prose">
          <div class='prose'>
</div>
        </div>
      </div>

  
</div>


    </div>

  </div>

            </div>
          </div>
        </div>
      </div>

    </div>

  </body>
</html>
